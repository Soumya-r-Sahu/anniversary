<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Anniversary Love">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ec4899">
    <title>‚ù§Ô∏è For My Sweet Jerry (Puja) ‚ù§Ô∏è</title>
    <meta name="description" content="A special surprise for my love">
    
    <!-- Preconnect for performance -->    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://unpkg.com">
    <!-- Preload important scripts -->
    <link rel="preload" href="https://unpkg.com/typed.js@2.0.12/lib/typed.min.js" as="script">
    
    <!-- Fonts with optimized loading -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
      <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüíï%3C/text%3E%3C/svg%3E">
</head>
<body class="bg-gradient-to-br from-pink-50 via-red-50 to-rose-100 overflow-x-hidden gradient-animation">
      <!-- Particles Background -->
    <div id="particles-js" class="fixed inset-0 z-0"></div>
    
    <!-- Floating Hearts Container for Burst Effects -->
    <div id="floating-hearts-container" class="fixed inset-0 pointer-events-none z-50"></div>
    
    <!-- Enhanced Background Music Player -->
    <div class="enhanced-music-player">
        <button id="music-toggle" class="music-control-btn" aria-label="Toggle Background Music">
            <span id="music-icon">üéµ</span>
            <div class="music-visualizer" id="music-visualizer" style="display: none;">
                <div class="music-bar"></div>
                <div class="music-bar"></div>
                <div class="music-bar"></div>
                <div class="music-bar"></div>
            </div>
        </button>
    </div>

    <!-- Welcome Section -->
    <section id="welcome" class="min-h-screen flex items-center justify-center relative z-10 px-4">        <div class="text-center w-full max-w-4xl">
            <div class="floating-hearts" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
                <div class="heart" style="left: 10%; animation-delay: 0s; animation-duration: 6s;"></div>
                <div class="heart" style="left: 30%; animation-delay: 1s; animation-duration: 7s;"></div>
                <div class="heart" style="left: 50%; animation-delay: 2s; animation-duration: 8s;"></div>
                <div class="heart" style="left: 70%; animation-delay: 3s; animation-duration: 6s;"></div>
                <div class="heart" style="left: 90%; animation-delay: 4s; animation-duration: 7s;"></div>
            </div>
            
            <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-500 mb-6 font-dancing leading-tight" data-aos="fade-up">
                üíï For My Sweet Jerry üíï
            </h1>
            <h2 class="text-xl sm:text-2xl md:text-3xl text-pink-700 mb-8 font-dancing leading-relaxed" data-aos="fade-up" data-aos-delay="200">
                My Dearest <span class="text-red-500 font-semibold">Pujuu (Jerry)</span> üê≠
            </h2>              <div class="text-lg md:text-xl text-gray-700 mb-8 max-w-2xl mx-auto leading-relaxed glassmorphism-bg rounded-2xl p-6" data-aos="fade-up" data-aos-delay="400">
                <span id="typed-text" class="border-r-2 border-pink-500"></span>
            </div>
            
            <a href="countdown.html" class="enhanced-button text-lg px-8 py-4 min-h-[44px] inline-block text-decoration-none" data-aos="fade-up" data-aos-delay="600" aria-label="Open your anniversary surprise">
                üéÅ Open Your Surprise üéÅ
            </a>
            
            <p class="text-base text-pink-600 mt-6 font-dancing" data-aos="fade-up" data-aos-delay="800">
                With all my love, Your Mankada (Soumya) üíñ
            </p>
        </div>
    </section>
      <!-- JavaScript Libraries -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="music-manager.js"></script>
    
    <script>
        // Initialize AOS (Animate On Scroll) with mobile optimizations
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({
                duration: isMobile ? 600 : 1000,
                easing: 'ease-in-out',
                once: true,
                mirror: false,
                offset: isMobile ? 50 : 120,
                delay: isMobile ? 50 : 100
            });
        });

        // Initialize Particles.js
        if (typeof particlesJS !== 'undefined') {            particlesJS('particles-js', {
                particles: {                    number: {
                        value: isMobile ? 10 : 18, // Further reduced for 60+ FPS
                        density: {
                            enable: true,
                            value_area: 1200 // Increased area for less density
                        }
                    },
                    color: {
                        value: ["#ff6b9d", "#ffa8cc", "#ffb3d6"]
                    },
                    shape: {
                        type: "circle",
                        stroke: {
                            width: 0,
                            color: "#000000"
                        }
                    },
                    opacity: {
                        value: 0.5,
                        random: false,
                        anim: {
                            enable: false,
                            speed: 1,
                            opacity_min: 0.1,
                            sync: false
                        }
                    },
                    size: {
                        value: 3,
                        random: true,
                        anim: {
                            enable: false,
                            speed: 40,
                            size_min: 0.1,
                            sync: false
                        }
                    },
                    line_linked: {
                        enable: true,
                        distance: 150,
                        color: "#ff6b9d",
                        opacity: 0.4,
                        width: 1
                    },                    move: {
                        enable: true,
                        speed: isMobile ? 0.6 : 1.2, // Reduced speed by 40% for smoother 60+ FPS
                        direction: "none",
                        random: false,
                        straight: false,
                        out_mode: "out",
                        bounce: false,
                        attract: {
                            enable: false,
                            rotateX: 600,
                            rotateY: 1200
                        }
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: {
                            enable: !isMobile,
                            mode: "repulse"
                        },
                        onclick: {
                            enable: true,
                            mode: "push"
                        },
                        resize: true
                    },
                    modes: {
                        grab: {
                            distance: 140,
                            line_linked: {
                                opacity: 1
                            }
                        },
                        bubble: {
                            distance: 400,
                            size: 40,
                            duration: 2,
                            opacity: 8,
                            speed: 3
                        },
                        repulse: {
                            distance: 200,
                            duration: 0.4
                        },
                        push: {
                            particles_nb: 4
                        },
                        remove: {
                            particles_nb: 2
                        }
                    }
                },
                retina_detect: true
            });        }
        
        // Enhanced Heart Burst Effects for "Open Your Surprise" Button
        function setupHeartBurstEffects() {
            const surpriseButton = document.querySelector('a[href="countdown.html"]');
            const heartsContainer = document.getElementById('floating-hearts-container');
            
            if (surpriseButton && heartsContainer) {
                surpriseButton.addEventListener('click', function(e) {
                    // Create burst effect
                    createHeartBurst(e.clientX, e.clientY);
                });
                
                // Also trigger on hover for extra magic
                surpriseButton.addEventListener('mouseenter', function(e) {
                    createHeartBurst(e.clientX, e.clientY, 5); // Smaller burst on hover
                });
            }
        }
        
        function createHeartBurst(x, y, count = 12) {
            const container = document.getElementById('floating-hearts-container');
            if (!container) return;
            
            for (let i = 0; i < count; i++) {
                const heart = document.createElement('div');
                heart.innerHTML = 'üíï';
                heart.className = 'burst-heart';
                
                // Random positioning around click point
                const offsetX = (Math.random() - 0.5) * 200;
                const offsetY = (Math.random() - 0.5) * 200;
                
                heart.style.left = `${x + offsetX}px`;
                heart.style.top = `${y + offsetY}px`;
                heart.style.fontSize = `${Math.random() * 20 + 15}px`;
                heart.style.animationDelay = `${Math.random() * 0.5}s`;
                heart.style.animationDuration = `${Math.random() * 1 + 1.5}s`;
                
                container.appendChild(heart);
                
                // Remove heart after animation
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 2500);
            }
        }
        
        // Enhanced Music Integration with Cross-Page Sync
        function setupEnhancedMusic() {
            // Wait for music manager to be available
            if (typeof window.musicManager === 'undefined') {
                setTimeout(setupEnhancedMusic, 100);
                return;
            }
            
            // Add clear previous visits functionality
            const clearVisitsBtn = document.createElement('button');
            clearVisitsBtn.innerHTML = 'üîÑ';
            clearVisitsBtn.className = 'clear-visits-btn';
            clearVisitsBtn.title = 'Clear Previous Visits';
            clearVisitsBtn.style.cssText = `
                position: fixed;
                top: 20px;
                right: 80px;
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                width: 50px;
                height: 50px;
                color: #ec4899;
                font-size: 18px;
                cursor: pointer;
                z-index: 1000;
                transition: all 0.3s ease;
            `;
            
            clearVisitsBtn.addEventListener('click', () => {
                if (confirm('Clear all previous visit data? This will reset music and other saved states.')) {
                    window.musicManager.clearPreviousVisits();
                    window.location.reload();
                }
            });
            
            clearVisitsBtn.addEventListener('mouseenter', () => {
                clearVisitsBtn.style.transform = 'scale(1.1)';
                clearVisitsBtn.style.boxShadow = '0 5px 20px rgba(236, 72, 153, 0.3)';
            });
            
            clearVisitsBtn.addEventListener('mouseleave', () => {
                clearVisitsBtn.style.transform = 'scale(1)';
                clearVisitsBtn.style.boxShadow = 'none';
            });
            
            document.body.appendChild(clearVisitsBtn);
            
            console.log('üéµ Enhanced music integration setup complete');
        }
                }
            }
            
            handleMusicToggle() {
                console.log('üéµ Synchronized Music toggle clicked!', {
                    audioElement: !!this.currentAudio,
                    isPaused: this.currentAudio ? this.currentAudio.paused : 'no audio'
                });
                
                if (!this.currentAudio) return;
                
                if (this.currentAudio.paused) {
                    console.log('‚ñ∂Ô∏è Attempting to play synchronized music...');
                    
                    // Resume from saved position if available
                    if (this.playbackState.currentTime > 0) {
                        this.currentAudio.currentTime = this.playbackState.currentTime;
                    }
                    
                    this.currentAudio.play()
                        .then(() => {
                            console.log('‚úÖ Synchronized music started successfully');
                            this.musicPlaying = true;
                            this.updateMusicButton(true);
                            this.playbackState.wasPlaying = true;
                            this.savePlaybackState();
                        })
                        .catch((error) => {
                            console.log('‚ö†Ô∏è Failed to play synchronized music:', error);
                        });
                } else {
                    console.log('‚è∏Ô∏è Pausing synchronized music...');
                    this.currentAudio.pause();
                    console.log('‚úÖ Synchronized music paused successfully');
                    this.musicPlaying = false;
                    this.updateMusicButton(false);
                    this.playbackState.wasPlaying = false;
                    this.playbackState.currentTime = this.currentAudio.currentTime;
                    this.savePlaybackState();
                }
            }
            
            setupInteractionListeners() {
                const events = ['click', 'touchstart', 'touchend', 'keydown', 'scroll', 'mousemove'];
                const handleFirstInteraction = () => {
                    if (this.playbackState.wasPlaying && this.currentAudio && this.currentAudio.paused) {
                        console.log('üéµ Attempting to resume music after user interaction...');
                        this.resumePlayback();
                    }
                    
                    // Remove listeners after first interaction
                    events.forEach(event => {
                        document.removeEventListener(event, handleFirstInteraction);
                    });
                };
                
                events.forEach(event => {
                    document.addEventListener(event, handleFirstInteraction, { once: true, passive: true });
                });
            }
            
            loadPlaybackState() {
                try {
                    const savedState = localStorage.getItem(this.musicStateKey);
                    if (savedState) {
                        this.playbackState = { ...this.playbackState, ...JSON.parse(savedState) };
                        console.log('üîÑ Loaded music state:', this.playbackState);
                    }
                } catch (error) {
                    console.log('‚ö†Ô∏è Failed to load music state:', error);
                }
            }
            
            savePlaybackState() {
                try {
                    this.playbackState.lastUpdated = Date.now();
                    localStorage.setItem(this.musicStateKey, JSON.stringify(this.playbackState));
                } catch (error) {
                    console.log('‚ö†Ô∏è Failed to save music state:', error);
                }
            }
            
            createAudioElement() {
                this.currentAudio = new Audio();
                this.currentAudio.preload = 'auto';
                this.currentAudio.volume = this.playbackState.volume;
                this.currentAudio.src = this.playlist[0];
                
                // Loop the song
                this.currentAudio.addEventListener('ended', () => {
                    this.currentAudio.currentTime = 0;
                    this.currentAudio.play();
                });
                
                // Handle errors
                this.currentAudio.addEventListener('error', () => {
                    console.log(`Error playing song: ${this.playlist[0]}`);
                });
            }
            
            setupStateTracking() {
                if (!this.currentAudio) return;
                
                // Track play/pause events
                this.currentAudio.addEventListener('play', () => {
                    this.musicPlaying = true;
                    this.playbackState.wasPlaying = true;
                    this.savePlaybackState();
                    this.updateMusicButton(true);
                });
                
                this.currentAudio.addEventListener('pause', () => {
                    this.musicPlaying = false;
                    this.playbackState.wasPlaying = false;
                    this.playbackState.currentTime = this.currentAudio.currentTime;
                    this.savePlaybackState();
                    this.updateMusicButton(false);
                });
                
                // Track time updates (save every 3 seconds to avoid too frequent writes)
                let lastSaveTime = 0;
                this.currentAudio.addEventListener('timeupdate', () => {
                    const now = Date.now();
                    if (now - lastSaveTime > 3000) { // Save every 3 seconds
                        this.playbackState.currentTime = this.currentAudio.currentTime;
                        this.playbackState.volume = this.currentAudio.volume;
                        this.savePlaybackState();
                        lastSaveTime = now;
                    }
                });
                
                // Track volume changes
                this.currentAudio.addEventListener('volumechange', () => {
                    this.playbackState.volume = this.currentAudio.volume;
                    this.savePlaybackState();
                });
                
                // Save state before page unload
                window.addEventListener('beforeunload', () => {
                    if (!this.currentAudio.paused) {
                        this.playbackState.wasPlaying = true;
                        this.playbackState.currentTime = this.currentAudio.currentTime;
                    } else {
                        this.playbackState.wasPlaying = false;
                    }
                    this.savePlaybackState();
                });
            }
            
            handleCrossPageResume() {
                const timeSinceLastUpdate = Date.now() - this.playbackState.lastUpdated;
                const maxResumeTime = 30 * 60 * 1000; // 30 minutes
                
                if (this.playbackState.wasPlaying && timeSinceLastUpdate < maxResumeTime) {
                    console.log('üîÑ Resuming music from countdown page at time:', this.playbackState.currentTime);
                    this.resumePlayback();
                } else if (this.playbackState.currentTime > 0) {
                    console.log('üéµ Music position saved, ready to resume manually');
                    this.currentAudio.currentTime = this.playbackState.currentTime;
                }
            }
            
            resumePlayback() {
                if (this.currentAudio) {
                    // Set saved volume and time
                    this.currentAudio.volume = this.playbackState.volume;
                    this.currentAudio.currentTime = this.playbackState.currentTime;
                    
                    // Attempt to resume playback
                    const playPromise = this.currentAudio.play();
                    
                    if (playPromise !== undefined) {
                        playPromise
                            .then(() => {
                                console.log('‚úÖ Successfully resumed synchronized music playback');
                                this.updateMusicButton(true);
                            })
                            .catch((error) => {
                                console.log('‚ö†Ô∏è Auto-resume blocked by browser:', error.message);
                                // Set up interaction listener for manual resume
                                this.setupInteractionListeners();
                            });
                    }
                }
            }
            
            updateMusicButton(isPlaying) {
                if (this.musicToggle) {
                    const icon = this.musicToggle.querySelector('#music-icon');
                    const visualizer = this.musicToggle.querySelector('#music-visualizer');
                    
                    if (isPlaying) {
                        if (icon) icon.textContent = 'üéµ';
                        this.musicToggle.classList.add('playing');
                        this.musicToggle.style.background = 'linear-gradient(135deg, #ff6b9d, #ffa8cc)';
                        if (visualizer) visualizer.style.display = 'flex';
                    } else {
                        if (icon) icon.textContent = 'üîá';
                        this.musicToggle.classList.remove('playing');
                        this.musicToggle.style.background = 'linear-gradient(135deg, #666, #999)';
                        if (visualizer) visualizer.style.display = 'none';
                    }
                }
            }
            
            attemptAutoplay() {
                if (this.currentAudio && this.currentAudio.paused) {
                    this.currentAudio.play()
                        .then(() => {
                            console.log('‚úÖ Autoplay successful on index page!');
                        })
                        .catch((error) => {
                            console.log('‚ö†Ô∏è Autoplay blocked, waiting for user interaction:', error.message);
                            this.setupInteractionListeners();
                        });
                }
            }
        }

        // Initialize Synchronized Music Manager
        let syncMusicManager;
        
        if (document.getElementById('music-toggle')) {
            syncMusicManager = new SynchronizedMusicManager();
            
            // Enhanced autoplay attempt after short delay
            setTimeout(() => {
                if (syncMusicManager) {
                    syncMusicManager.attemptAutoplay();
                }
            }, 1000);
        } else {
            console.log('‚ùå Music toggle button not found');
        }

        console.log('üíï Enhanced anniversary index page with synchronized music loaded! üíï');
        
        // Heart burst effect for click interactions
        function createHeartBurst(x, y) {
            const heartsContainer = document.getElementById('floating-hearts-container');
            if (!heartsContainer) return;
            
            const heartEmojis = ['üíï', 'üíñ', 'üíù', 'üíó', 'üíò', '‚ù§Ô∏è', 'üíû', 'üíì', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú'];
            const burstCount = Math.random() * 5 + 4; // 4-9 hearts in burst (reduced for performance)
            
            for (let i = 0; i < burstCount; i++) {
                const heart = document.createElement('div');
                heart.className = 'burst-heart';
                heart.textContent = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];
                
                // Random burst properties
                const angle = (Math.PI * 2 * i) / burstCount + (Math.random() - 0.5) * 0.5;
                const velocity = Math.random() * 200 + 100; // 100-300px
                const size = Math.random() * 15 + 10; // 10-25px
                const duration = Math.random() * 1.5 + 1; // 1-2.5 seconds
                const rotation = Math.random() * 720 + 360; // 360-1080 degrees
                const gravity = Math.random() * 200 + 150; // Fall speed
                
                const endX = x + Math.cos(angle) * velocity;
                const endY = y + Math.sin(angle) * velocity - 50; // Start upward
                const finalY = y + gravity; // Fall down with gravity
                  heart.style.cssText = `
                    position: fixed;
                    left: ${x}px;
                    top: ${y}px;
                    font-size: ${size}px;
                    pointer-events: none;
                    z-index: 100;
                    animation: heartBurstOptimized ${duration}s ease-out forwards;
                    --endX: ${endX}px;
                    --endY: ${endY}px;
                    --finalY: ${finalY}px;
                    --rotation: ${rotation}deg;
                    transform: translate3d(0, 0, 0);
                    will-change: transform, opacity;
                    filter: drop-shadow(0 0 8px rgba(255, 107, 157, 0.6)) hue-rotate(${Math.random() * 60 - 30}deg);
                `;
                
                heartsContainer.appendChild(heart);
                
                // Remove heart after animation
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, duration * 1000 + 100);
            }
        }
        
        // Add burst animation styles
        const burstStyle = document.createElement('style');
        burstStyle.textContent = `
            @keyframes heartBurst {
                0% {
                    transform: translate(0, 0) rotate(0deg) scale(0.3);
                    opacity: 1;
                }
                30% {
                    transform: translate(calc(var(--endX) - 50vw), calc(var(--endY) - 50vh)) rotate(calc(var(--rotation) * 0.3)) scale(1.2);
                    opacity: 1;
                }
                70% {
                    opacity: 0.8;
                }
                100% {
                    transform: translate(calc(var(--endX) - 50vw), calc(var(--finalY) - 50vh)) rotate(var(--rotation)) scale(0.1);
                    opacity: 0;
                }
            }
            
            .burst-heart {
                user-select: none;
                will-change: transform, opacity;
            }
        `;
        document.head.appendChild(burstStyle);
        
        // Add emoji burst effect to the "Open Your Surprise" button
        document.addEventListener('DOMContentLoaded', function() {
            const surpriseButton = document.querySelector('a[href="countdown.html"]');
            if (surpriseButton) {
                surpriseButton.addEventListener('click', function(e) {
                    const rect = this.getBoundingClientRect();
                    const x = rect.left + rect.width / 2;
                    const y = rect.top + rect.height / 2;
                    createHeartBurst(x, y);
                });
            }        });    </script>
      <!-- Typed.js for typewriter animation -->
    <script src="https://unpkg.com/typed.js@2.0.12/lib/typed.min.js"></script>
    <script>
        // Typed.js initialization (copied exactly from script.js/anniversary.html)
        function initTypedText() {
            if (typeof Typed !== 'undefined' && document.getElementById('typed-text')) {
                new Typed('#typed-text', {
                    strings: [
                        "From June 16, 2024 to forever...",
                        "Every moment with you is magical ‚ú®",
                        "You are my greatest blessing üíï",
                        "My sweet Jerry, my everything üêí‚ù§Ô∏è"
                    ],
                    typeSpeed: 50,
                    backSpeed: 30,
                    backDelay: 2000,
                    loop: true,
                    showCursor: true,
                    cursorChar: '|'
                });
            }
        }
        
        // Initialize everything when DOM is loaded (same pattern as script.js)
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize typed text (same timing as script.js)
            setTimeout(initTypedText, 1000);
        });
    </script>
</body>
</html>
