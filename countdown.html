<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ff6b9d">
    <title>Countdown to Our Special Day ❤️</title>
    <meta name="description" content="Countdown to our anniversary - June 16th">

    <!-- Preload critical fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">

    <style>
        /* Enhanced countdown styles */
        .countdown-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            padding: 3rem;
            box-shadow:
                0 20px 60px rgba(236, 72, 153, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .countdown-number {
            background: linear-gradient(135deg, #ec4899, #f472b6);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 4rem;
            font-weight: 700;
            text-shadow: 0 4px 20px rgba(236, 72, 153, 0.3);
        }

        .countdown-label {
            color: #ec4899;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.875rem;
        }

        .countdown-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .countdown-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(236, 72, 153, 0.3);
        }

        @media (max-width: 640px) {
            .countdown-number {
                font-size: 2.5rem;
            }
            .countdown-container {
                padding: 2rem;
            }
        }

        /* Clear Previous Visits Button */
        .clear-visits-btn {
            position: fixed;
            top: 20px;
            right: 80px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: #ec4899;
            font-size: 18px;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
        }        .clear-visits-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(236, 72, 153, 0.3);
        }        /* Enhanced Redirect Countdown Animations */
        @keyframes urgentPulse {
            0% { transform: scale(1.3); }
            100% { transform: scale(1.5); text-shadow: 0 0 30px rgba(255, 255, 255, 1); }
        }

        /* Blast Animation for Counter Box Removal */
        @keyframes blastAnimation {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
                filter: blur(0px) brightness(1);
            }
            25% {
                transform: scale(1.2) rotate(5deg);
                opacity: 0.9;
                filter: blur(1px) brightness(1.5);
                box-shadow:
                    0 0 30px rgba(236, 72, 153, 0.8),
                    inset 0 0 20px rgba(255, 255, 255, 0.5);
            }
            50% {
                transform: scale(1.5) rotate(-10deg);
                opacity: 0.7;
                filter: blur(3px) brightness(2);
                box-shadow:
                    0 0 50px rgba(236, 72, 153, 1),
                    0 0 100px rgba(255, 107, 157, 0.6),
                    inset 0 0 30px rgba(255, 255, 255, 0.7);
            }
            75% {
                transform: scale(0.8) rotate(15deg);
                opacity: 0.4;
                filter: blur(5px) brightness(3);
                box-shadow:
                    0 0 80px rgba(236, 72, 153, 0.8),
                    0 0 150px rgba(255, 107, 157, 0.4);
            }
            100% {
                transform: scale(0) rotate(180deg);
                opacity: 0;
                filter: blur(10px) brightness(5);
                box-shadow: none;
            }
        }

        @keyframes blastParticles {
            0% {
                transform: scale(0) translate(0, 0);
                opacity: 1;
            }
            50% {
                transform: scale(1) translate(var(--dx), var(--dy));
                opacity: 0.8;
            }
            100% {
                transform: scale(0) translate(calc(var(--dx) * 2), calc(var(--dy) * 2));
                opacity: 0;
            }
        }

        .removing {
            animation: blastAnimation 1s ease-out forwards;
            z-index: 100;
            position: relative;
        }        .blast-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #ff6b9d, #ec4899);
            border-radius: 50%;
            pointer-events: none;
            z-index: 101;
            animation: blastParticles 1.5s ease-out forwards;
        }

        @keyframes rippleBlast {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
                border-width: 6px;
            }
            50% {
                transform: translate(-50%, -50%) scale(5);
                opacity: 0.6;
                border-width: 3px;
            }
            100% {
                transform: translate(-50%, -50%) scale(10);
                opacity: 0;
                border-width: 1px;
            }
        }        /* Responsive fixes for countdown layout */
        @media (max-width: 768px) {
            .countdown-container .grid {
                gap: 1rem;
            }
            .countdown-item {
                padding: 1rem;
            }
            .countdown-number {
                font-size: 2rem;
            }
            .blast-particle {
                width: 6px;
                height: 6px;
            }

            /* Mobile-specific grid layouts */
            .countdown-container .grid.grid-cols-2.md\\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr) !important;
                grid-template-rows: repeat(2, 1fr);
            }

            .countdown-container .grid.grid-cols-3.md\\:grid-cols-3 {
                grid-template-columns: repeat(3, 1fr) !important;
                grid-template-rows: 1fr;
            }

            .countdown-container .grid.grid-cols-2.md\\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr) !important;
                grid-template-rows: 1fr;
            }

            .countdown-container .grid.grid-cols-1.md\\:grid-cols-1 {
                grid-template-columns: 1fr !important;
                grid-template-rows: 1fr;
            }
        }        @media (max-width: 480px) {
            .countdown-container {
                padding: 1.5rem;
            }
            .countdown-container .grid {
                gap: 0.75rem;
            }
            .countdown-item {
                padding: 0.75rem;
            }
            .countdown-number {
                font-size: 1.5rem;
            }
            .countdown-label {
                font-size: 0.75rem;
            }
            .blast-particle {
                width: 4px;
                height: 4px;
            }

            /* Ultra-mobile specific adjustments */
            .countdown-container .grid.grid-cols-3.md\\:grid-cols-3 {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 0.5rem;
            }
              /* Enhanced mobile-layout rules for small screens - Higher specificity */
            .countdown-container .grid.mobile-layout.grid-cols-3.md\\:grid-cols-3 {
                gap: 0.5rem !important;
            }

            .countdown-container .grid.mobile-layout.grid-cols-2.md\\:grid-cols-2,
            .countdown-container .grid.mobile-layout.grid-cols-2.md\\:grid-cols-4 {
                gap: 0.75rem !important;
            }

            .countdown-container .grid.mobile-layout .countdown-item {
                padding: 0.75rem !important;
                min-width: auto !important;
            }

            .countdown-container .grid.mobile-layout .countdown-number {
                font-size: 1.5rem !important;
            }

            .countdown-container .grid.mobile-layout .countdown-label {
                font-size: 0.75rem !important;
            }
        }/* Enhanced container transitions */
        .countdown-container .grid {
            transition: all 0.3s ease-in-out;
        }

        .countdown-item {
            transition: all 0.3s ease-in-out;
            will-change: transform, opacity;
        }

        /* Large desktop optimizations */
        @media (min-width: 1200px) {
            .countdown-container .grid {
                gap: 2rem;
            }

            .countdown-container .countdown-item {
                padding: 2rem;
                min-width: 140px;
                max-width: 220px;
            }

            .countdown-number {
                font-size: 4rem;
            }

            .countdown-label {
                font-size: 1rem;
            }
        }

        /* Ultra-wide desktop optimizations */
        @media (min-width: 1600px) {
            .countdown-container .grid {
                gap: 2.5rem;
                max-width: 1200px;
                margin: 0 auto;
            }

            .countdown-container .countdown-item {
                padding: 2.5rem;
                min-width: 160px;
                max-width: 250px;
            }
        }/* Desktop-specific layout: Always use row-style layout */
        @media (min-width: 769px) {
            .countdown-container .grid.grid-cols-2.md\\:grid-cols-4,
            .countdown-container .grid.grid-cols-3.md\\:grid-cols-3,
            .countdown-container .grid.grid-cols-2.md\\:grid-cols-2,
            .countdown-container .grid.grid-cols-1.md\\:grid-cols-1 {
                /* Force single row layout for all configurations on desktop */
                grid-template-rows: 1fr !important;
                justify-items: center;
                align-items: center;
                gap: 1.5rem;
            }

            .countdown-container .grid.grid-cols-2.md\\:grid-cols-4 {
                /* 4 boxes in a single row on desktop */
                grid-template-columns: repeat(4, 1fr) !important;
            }

            .countdown-container .grid.grid-cols-3.md\\:grid-cols-3 {
                /* 3 boxes in a single row on desktop */
                grid-template-columns: repeat(3, 1fr) !important;
            }

            .countdown-container .grid.grid-cols-2.md\\:grid-cols-2 {
                /* 2 boxes in a single row on desktop */
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .countdown-container .grid.grid-cols-1.md\\:grid-cols-1 {
                /* 1 box centered on desktop */
                grid-template-columns: 1fr !important;
            }

            /* Enhanced spacing for desktop row layout */
            .countdown-container .countdown-item {
                padding: 1.75rem;
                min-width: 120px;
                max-width: 200px;
            }
        }        /* Mobile-specific layout improvements - Higher specificity */
        @media (max-width: 768px) {
            /* Enhanced mobile-layout rules with higher specificity */
            .countdown-container .grid.mobile-layout.grid-cols-3.md\\:grid-cols-3 {
                /* Force single row for 3 boxes on mobile */
                grid-template-columns: repeat(3, 1fr) !important;
                grid-template-rows: 1fr !important;
                justify-items: center;
                align-items: center;
                gap: 1rem;
            }

            .countdown-container .grid.mobile-layout.grid-cols-2.md\\:grid-cols-4 {
                /* 2x2 grid for 4 boxes on mobile */
                grid-template-columns: repeat(2, 1fr) !important;
                grid-template-rows: repeat(2, 1fr) !important;
                gap: 1rem;
            }

            .countdown-container .grid.mobile-layout.grid-cols-2.md\\:grid-cols-2 {
                /* Single row for 2 boxes on mobile */
                grid-template-columns: repeat(2, 1fr) !important;
                grid-template-rows: 1fr !important;
                justify-items: center;
                align-items: center;
                gap: 1rem;
            }

            .countdown-container .grid.mobile-layout.grid-cols-1.md\\:grid-cols-1 {
                /* Centered single box on mobile */
                grid-template-columns: 1fr !important;
                grid-template-rows: 1fr !important;
                justify-items: center;
                align-items: center;
            }

            .countdown-container .grid.mobile-layout .countdown-item {
                min-width: 0; /* Prevent overflow */
                max-width: 100%;
                flex-shrink: 1;
            }
        }

        /* Prevent layout shift during animations */
        .countdown-container {
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        @keyframes enhanced-confetti-fall {
            0% {
                transform: translateY(-10px) rotateZ(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) rotateZ(180deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotateZ(360deg);
                opacity: 0;
            }
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-10px) rotateZ(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotateZ(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 via-red-50 to-rose-100 min-h-screen overflow-x-hidden gradient-animation">

    <!-- Particles Background -->
    <div id="particles-js" class="fixed inset-0 z-0"></div>    <!-- CSS Floating Bubbles Pattern -->
    <div class="floating-bubbles" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
        <div class="bubble" style="left: 10%; animation-delay: 0s; animation-duration: 6s;"></div>
        <div class="bubble" style="left: 30%; animation-delay: 1s; animation-duration: 7s;"></div>
        <div class="bubble" style="left: 50%; animation-delay: 2s; animation-duration: 8s;"></div>
        <div class="bubble" style="left: 70%; animation-delay: 3s; animation-duration: 6s;"></div>
        <div class="bubble" style="left: 90%; animation-delay: 4s; animation-duration: 7s;"></div>
    </div>

    <!-- Enhanced Background Music Player -->
    <div class="enhanced-music-player">
        <button id="music-toggle" class="music-control-btn" aria-label="Toggle Background Music">
            <span id="music-icon">🎵</span>
            <div class="music-visualizer" id="music-visualizer" style="display: none;">
                <div class="music-bar"></div>
                <div class="music-bar"></div>
                <div class="music-bar"></div>
                <div class="music-bar"></div>
            </div>
        </button>
    </div>

    <!-- Main Content -->
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="text-center max-w-4xl mx-auto">
            <!-- Header -->
            <div class="mb-12" data-aos="fade-up">
                <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-red-500 mb-4 font-dancing">
                    Counting Down to Forever 💕
                </h1>
                <p class="text-xl md:text-2xl text-pink-700 font-dancing">
                    Our love story continues...
                </p>
            </div>

            <!-- Countdown Display -->
            <div class="countdown-container mb-12" data-aos="fade-up" data-aos-delay="200">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <div class="countdown-item text-center">
                        <div class="countdown-number" id="days">0</div>
                        <div class="countdown-label">Days</div>
                    </div>
                    <div class="countdown-item text-center">
                        <div class="countdown-number" id="hours">0</div>
                        <div class="countdown-label">Hours</div>
                    </div>
                    <div class="countdown-item text-center">
                        <div class="countdown-number" id="minutes">0</div>
                        <div class="countdown-label">Minutes</div>
                    </div>
                    <div class="countdown-item text-center">
                        <div class="countdown-number" id="seconds">0</div>
                        <div class="countdown-label">Seconds</div>
                    </div>
                </div>
            </div>
              <!-- Message with Typewriter Effect -->
            <div class="glassmorphism-bg rounded-2xl p-8 mb-8" data-aos="fade-up" data-aos-delay="400">
                <h2 class="text-2xl md:text-3xl font-dancing text-pink-600 mb-4">
                    Until Our Next Special Moment
                </h2>
                <p class="text-lg text-gray-700 leading-relaxed mb-4">
                    <span id="typed-text" class=""></span>
                </p>            </div>
        </div>
    </div>    <!-- Floating Bubbles Container (Dynamic) -->
    <div class="floating-bubbles" id="floating-bubbles-container">
        <!-- Bubbles will be dynamically generated with random animations -->
    </div>

    <!-- Audio Element for Background Music -->
    <audio id="background-music" preload="auto" loop>
        <source src="music/song1.m4a" type="audio/mp4">
        <source src="music/song1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="music-manager.js"></script>
    <script src="https://unpkg.com/typed.js@2.0.12/lib/typed.min.js"></script>

    <script>
        // Enhanced Music Integration with Cross-Page Sync
        function setupEnhancedMusic() {
            if (typeof window.musicManager === 'undefined') {
                setTimeout(setupEnhancedMusic, 100);
                return;
            }

            // Add clear previous visits functionality
            const clearVisitsBtn = document.createElement('button');
            clearVisitsBtn.innerHTML = '🔄';
            clearVisitsBtn.className = 'clear-visits-btn';
            clearVisitsBtn.title = 'Clear Previous Visits';
            clearVisitsBtn.addEventListener('click', () => {
                if (confirm('Clear all previous visit data? This will reset music and other saved states.')) {
                    window.musicManager.clearPreviousVisits();
                    window.location.reload();
                }
            });
            clearVisitsBtn.addEventListener('mouseenter', () => {
                clearVisitsBtn.style.transform = 'scale(1.1)';
                clearVisitsBtn.style.boxShadow = '0 5px 20px rgba(236, 72, 153, 0.3)';
            });
            clearVisitsBtn.addEventListener('mouseleave', () => {
                clearVisitsBtn.style.transform = 'scale(1)';
                clearVisitsBtn.style.boxShadow = 'none';
            });
            document.body.appendChild(clearVisitsBtn);
            console.log('🎵 Enhanced music integration setup complete');
        }

        // Initialize particles.js with mobile detection
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        // Initialize Particles.js (same configuration as index.html for consistency)
        if (typeof particlesJS !== 'undefined') {
            particlesJS('particles-js', {
                particles: {
                    number: {
                        value: isMobile ? 10 : 18,
                        density: {
                            enable: true,
                            value_area: 1200
                        }
                    },
                    color: {
                        value: ["#ff6b9d", "#ffa8cc", "#ffb3d6"]
                    },
                    shape: {
                        type: "circle",
                        stroke: {
                            width: 0,
                            color: "#000000"
                        }
                    },
                    opacity: {
                        value: 0.4,
                        random: false,
                        anim: {
                            enable: false,
                            speed: 1,
                            opacity_min: 0.1,
                            sync: false
                        }
                    },
                    size: {
                        value: 2.5,
                        random: true,
                        anim: {
                            enable: false,
                            speed: 40,
                            size_min: 0.1,
                            sync: false
                        }
                    },
                    line_linked: {
                        enable: true,
                        distance: 120,
                        color: "#ff6b9d",
                        opacity: 0.3,
                        width: 0.8
                    },
                    move: {
                        enable: true,
                        speed: isMobile ? 0.6 : 1.2,
                        direction: "none",
                        random: false,
                        straight: false,
                        out_mode: "out",
                        bounce: false,
                        attract: {
                            enable: false,
                            rotateX: 600,
                            rotateY: 1200
                        }
                    }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: {
                            enable: !isMobile,
                            mode: "repulse"
                        },
                        onclick: {
                            enable: true,
                            mode: "push"
                        },
                        resize: true
                    },
                    modes: {
                        grab: {
                            distance: 140,
                            line_linked: {
                                opacity: 1
                            }
                        },
                        bubble: {
                            distance: 400,
                            size: 40,
                            duration: 2,
                            opacity: 8,
                            speed: 3
                        },
                        repulse: {
                            distance: 200,
                            duration: 0.4
                        },
                        push: {
                            particles_nb: 3
                        },
                        remove: {
                            particles_nb: 2
                        }
                    }
                },
                retina_detect: true
            });
        }
          // Enhanced Countdown Logic with Dynamic Box Removal
        class EnhancedCountdown {
            constructor(targetDate) {
                this.targetDate = new Date(targetDate);
                this.elements = {
                    days: document.getElementById('days'),
                    hours: document.getElementById('hours'),
                    minutes: document.getElementById('minutes'),
                    seconds: document.getElementById('seconds')
                };
                this.containers = {
                    days: document.getElementById('days').closest('.countdown-item'),
                    hours: document.getElementById('hours').closest('.countdown-item'),
                    minutes: document.getElementById('minutes').closest('.countdown-item'),
                    seconds: document.getElementById('seconds').closest('.countdown-item')
                };
                this.interval = null;
                this.removedBoxes = [];
                this.start();
            }

            start() {
                this.update();
                this.interval = setInterval(() => this.update(), 1000);
            }

            stop() {
                if (this.interval) {
                    clearInterval(this.interval);
                    this.interval = null;
                }
            }

            update() {
                const now = new Date().getTime();
                const distance = this.targetDate.getTime() - now;

                if (distance < 0) {
                    this.onComplete();
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Update countdown numbers with animation
                this.animateNumber(this.elements.days, days);
                this.animateNumber(this.elements.hours, hours);
                this.animateNumber(this.elements.minutes, minutes);
                this.animateNumber(this.elements.seconds, seconds);
                  // Handle dynamic box removal
                this.handleBoxRemoval(days, hours, minutes, seconds);

                // Update grid layout based on visible boxes (smooth version for regular updates)
                this.updateGridLayout();
            }
              handleBoxRemoval(days, hours, minutes, seconds) {
                // Remove days box when it reaches 0
                if (days === 0 && !this.removedBoxes.includes('days') && this.containers.days) {
                    this.removeBox('days');
                }

                // Remove hours box when it reaches 0 and days box is already removed
                if (hours === 0 && days === 0 && !this.removedBoxes.includes('hours') && this.containers.hours) {
                    this.removeBox('hours');
                }

                // Remove minutes box when it reaches 0 and both days and hours boxes are removed
                if (minutes === 0 && days === 0 && hours === 0 && !this.removedBoxes.includes('minutes') && this.containers.minutes) {
                    this.removeBox('minutes');
                }
            }

            removeBox(boxType) {
                const container = this.containers[boxType];

                // Check if box is already removed or doesn't exist
                if (!container || this.removedBoxes.includes(boxType)) {
                    console.log(`⚠️ Box ${boxType} already removed or doesn't exist`);
                    return;
                }

                // Mark as removed immediately to prevent duplicate calls
                this.removedBoxes.push(boxType);
                console.log(`🎯 Marking ${boxType} box for removal. Removed boxes: [${this.removedBoxes.join(', ')}]`);

                // Create blast particles before animation
                this.createBlastParticles(container);

                // Add enhanced blast animation class
                container.classList.add('removing');

                // Create additional visual effects
                this.createBlastRipple(container);

                setTimeout(() => {
                    container.style.display = 'none';
                    console.log(`💥 Removed ${boxType} box with blast animation!`);

                    // Trigger layout update with smooth transition
                    this.updateGridLayoutSmooth();
                }, 1000); // Increased timeout to match blast animation duration
            }

            createBlastParticles(container) {
                const rect = container.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                // Create 12 blast particles
                for (let i = 0; i < 12; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'blast-particle';

                    // Calculate particle direction
                    const angle = (Math.PI * 2 * i) / 12;
                    const distance = 80 + Math.random() * 40; // 80-120px
                    const dx = Math.cos(angle) * distance;
                    const dy = Math.sin(angle) * distance;

                    particle.style.cssText = `
                        left: ${centerX}px;
                        top: ${centerY}px;
                        --dx: ${dx}px;
                        --dy: ${dy}px;
                        background: radial-gradient(circle,
                            hsl(${320 + Math.random() * 40}, 80%, 65%),
                            hsl(${300 + Math.random() * 60}, 70%, 55%)
                        );
                        animation-delay: ${Math.random() * 0.2}s;
                    `;

                    document.body.appendChild(particle);

                    // Remove particle after animation
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 1500);
                }
            }

            createBlastRipple(container) {
                const ripple = document.createElement('div');
                const rect = container.getBoundingClientRect();

                ripple.style.cssText = `
                    position: fixed;
                    left: ${rect.left + rect.width / 2}px;
                    top: ${rect.top + rect.height / 2}px;
                    width: 20px;
                    height: 20px;
                    border: 3px solid rgba(236, 72, 153, 0.8);
                    border-radius: 50%;
                    transform: translate(-50%, -50%);
                    pointer-events: none;
                    z-index: 102;
                    animation: rippleBlast 1s ease-out forwards;
                `;

                document.body.appendChild(ripple);

                setTimeout(() => {
                    if (ripple.parentNode) {
                        ripple.parentNode.removeChild(ripple);
                    }
                }, 1000);
            }

            updateGridLayoutSmooth() {
                const countdownGrid = document.querySelector('.countdown-container .grid');
                if (countdownGrid) {
                    // Calculate visible boxes, ensuring it's never negative
                    const visibleBoxes = Math.max(0, 4 - this.removedBoxes.length);
                    const isMobile = window.innerWidth <= 768;

                    console.log(`🔄 Grid Layout Update: ${visibleBoxes} boxes, Mobile: ${isMobile}, Removed: [${this.removedBoxes.join(', ')}]`);

                    // Don't update if no boxes are visible
                    if (visibleBoxes === 0) {
                        console.log(`⚠️ No visible boxes remaining, skipping grid update`);
                        return;
                    }

                    // Add transition for smooth layout change
                    countdownGrid.style.transition = 'all 0.5s ease-in-out';

                    // Clear existing grid classes
                    countdownGrid.className = countdownGrid.className.replace(/grid-cols-\d+/g, '');
                    countdownGrid.className = countdownGrid.className.replace(/md:grid-cols-\d+/g, '');

                    // Apply new grid classes based on visible boxes
                    if (visibleBoxes === 4) {
                        // 4 boxes: 2x2 on mobile, 1x4 on desktop
                        countdownGrid.classList.add('grid-cols-2', 'md:grid-cols-4');
                    } else if (visibleBoxes === 3) {
                        // 3 boxes: 1x3 row on mobile, 1x3 on desktop
                        countdownGrid.classList.add('grid-cols-3', 'md:grid-cols-3');
                    } else if (visibleBoxes === 2) {
                        // 2 boxes: 1x2 row on both mobile and desktop
                        countdownGrid.classList.add('grid-cols-2', 'md:grid-cols-2');
                    } else if (visibleBoxes === 1) {
                        // 1 box: centered on both mobile and desktop
                        countdownGrid.classList.add('grid-cols-1', 'md:grid-cols-1');
                    }

                    // Add mobile-specific class for special handling
                    if (isMobile) {
                        countdownGrid.classList.add('mobile-layout');
                        console.log(`📱 Mobile layout applied: ${countdownGrid.className}`);
                    } else {
                        countdownGrid.classList.remove('mobile-layout');
                        console.log(`🖥️ Desktop layout applied: ${countdownGrid.className}`);
                    }

                    // Remove transition after layout change
                    setTimeout(() => {
                        countdownGrid.style.transition = '';
                    }, 500);
                }
            }
            updateGridLayout() {
                const countdownGrid = document.querySelector('.countdown-container .grid');
                if (countdownGrid) {
                    // Calculate visible boxes, ensuring it's never negative
                    const visibleBoxes = Math.max(0, 4 - this.removedBoxes.length);
                    const isMobile = window.innerWidth <= 768;

                    // Don't update if no boxes are visible
                    if (visibleBoxes === 0) {
                        return;
                    }

                    // Update grid classes based on visible boxes
                    countdownGrid.className = countdownGrid.className.replace(/grid-cols-\d+/g, '');
                    countdownGrid.className = countdownGrid.className.replace(/md:grid-cols-\d+/g, '');

                    if (visibleBoxes === 4) {
                        // 4 boxes: 2x2 on mobile, 1x4 on desktop
                        countdownGrid.classList.add('grid-cols-2', 'md:grid-cols-4');
                    } else if (visibleBoxes === 3) {
                        // 3 boxes: 1x3 row on mobile, 1x3 on desktop
                        countdownGrid.classList.add('grid-cols-3', 'md:grid-cols-3');
                    } else if (visibleBoxes === 2) {
                        // 2 boxes: 1x2 row on both mobile and desktop
                        countdownGrid.classList.add('grid-cols-2', 'md:grid-cols-2');
                    } else if (visibleBoxes === 1) {
                        // 1 box: centered on both mobile and desktop
                        countdownGrid.classList.add('grid-cols-1', 'md:grid-cols-1');
                    }

                    // Add mobile-specific class for special handling
                    if (isMobile) {
                        countdownGrid.classList.add('mobile-layout');
                    } else {
                        countdownGrid.classList.remove('mobile-layout');
                    }
                }
            }

            animateNumber(element, newValue) {
                if (!element) return;

                const currentValue = parseInt(element.textContent) || 0;
                if (currentValue !== newValue) {
                    element.classList.add('updating');

                    setTimeout(() => {
                        element.textContent = newValue;
                        element.classList.remove('updating');
                    }, 150);
                }
            }
            createExtraConfetti() {
                // Create more intense confetti for final countdown
                for (let i = 0; i < 15; i++) {
                    setTimeout(() => {
                        this.createConfetti();
                    }, i * 50);
                }
            }

            createConfetti() {
                const colors = ['#ff6b9d', '#ffa8cc', '#ffb3d6', '#ff8fab', '#a855f7', '#06b6d4'];
                const confetti = document.createElement('div');

                confetti.style.cssText = `
                    position: fixed;
                    width: ${Math.random() * 8 + 6}px;
                    height: ${Math.random() * 8 + 6}px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${Math.random() * 100}vw;
                    top: -10px;
                    z-index: 9999;
                    pointer-events: none;
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                    animation: enhanced-confetti-fall ${Math.random() * 2 + 2}s linear forwards;
                    box-shadow: 0 0 10px rgba(255, 107, 157, 0.5);
                `;
                  document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 4000);
            }

            onComplete() {
                console.log('🎊 Countdown Complete!');

                // Stop the countdown interval
                this.stop();

                // Update all displays to show zeros
                this.animateNumber(this.elements.days, 0);
                this.animateNumber(this.elements.hours, 0);
                this.animateNumber(this.elements.minutes, 0);
                this.animateNumber(this.elements.seconds, 0);

                // Show completion celebration
                this.showCompletionCelebration();

                // Start redirect countdown
                this.startRedirectCountdown();
            }

            showCompletionCelebration() {
                // Create full-screen celebration overlay
                const overlay = document.createElement('div');
                overlay.className = 'completion-celebration';
                overlay.innerHTML = `
                    <div class="celebration-content">
                        <h1>🎉 Happy Anniversary! 🎉</h1>
                        <p>The day has finally arrived!</p>
                        <div class="celebration-hearts"></div>
                        <div class="redirect-info">
                            <p>Redirecting to anniversary page in <span id="redirect-countdown">5</span> seconds...</p>
                            <button id="redirect-now" class="redirect-button">Go Now! 💕</button>
                        </div>
                    </div>
                `;

                // Add styles for the celebration overlay
                const style = document.createElement('style');
                style.textContent = `
                    .completion-celebration {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: linear-gradient(135deg, #ff6b9d, #c44569, #f8b500);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        z-index: 10000;
                        animation: celebrationFadeIn 0.5s ease-out;
                    }

                    .celebration-content {
                        text-align: center;
                        color: white;
                        max-width: 600px;
                        padding: 2rem;
                    }

                    .celebration-content h1 {
                        font-size: 3rem;
                        margin-bottom: 1rem;
                        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                        animation: bounce 1s infinite alternate;
                    }

                    .celebration-content p {
                        font-size: 1.5rem;
                        margin-bottom: 2rem;
                        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                    }

                    .redirect-info {
                        background: rgba(255,255,255,0.2);
                        padding: 1.5rem;
                        border-radius: 15px;
                        backdrop-filter: blur(10px);
                        margin-top: 2rem;
                    }

                    .redirect-info p {
                        font-size: 1.2rem;
                        margin-bottom: 1rem;
                    }

                    #redirect-countdown {
                        font-weight: bold;
                        font-size: 1.5em;
                        color: #ffeb3b;
                        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                    }

                    .redirect-button {
                        background: linear-gradient(45deg, #ff4081, #e91e63);
                        color: white;
                        border: none;
                        padding: 12px 30px;
                        font-size: 1.1rem;
                        border-radius: 25px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    }

                    .redirect-button:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
                        background: linear-gradient(45deg, #e91e63, #ad1457);
                    }

                    @keyframes celebrationFadeIn {
                        from { opacity: 0; transform: scale(0.8); }
                        to { opacity: 1; transform: scale(1); }
                    }

                    @keyframes bounce {
                        from { transform: translateY(0); }
                        to { transform: translateY(-10px); }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(overlay);

                // Setup immediate redirect button
                const redirectButton = overlay.querySelector('#redirect-now');
                if (redirectButton) {
                    redirectButton.addEventListener('click', () => {
                        this.redirectToAnniversary();
                    });
                }

                // Trigger celebration effects
                this.triggerMassiveCelebration();
            }

            startRedirectCountdown() {
                let redirectSeconds = 5;
                const redirectCountdownElement = document.getElementById('redirect-countdown');

                // Update countdown display immediately
                if (redirectCountdownElement) {
                    redirectCountdownElement.textContent = redirectSeconds;
                }

                // Start countdown interval
                const redirectInterval = setInterval(() => {
                    redirectSeconds--;

                    if (redirectCountdownElement) {
                        redirectCountdownElement.textContent = redirectSeconds;

                        // Add visual emphasis for last 3 seconds
                        if (redirectSeconds <= 3) {
                            redirectCountdownElement.style.animation = 'pulse 0.5s ease-in-out';
                            redirectCountdownElement.style.color = '#ff5722';
                        }
                    }

                    // Redirect when countdown reaches 0
                    if (redirectSeconds <= 0) {
                        clearInterval(redirectInterval);
                        this.redirectToAnniversary();
                    }
                }, 1000);
            }

            redirectToAnniversary() {
                console.log('🎊 Redirecting to anniversary page...');

                // Add fade out effect before redirect
                const overlay = document.querySelector('.completion-celebration');
                if (overlay) {
                    overlay.style.transition = 'opacity 0.5s ease-out';
                    overlay.style.opacity = '0';
                }

                // Perform redirect with fallback
                setTimeout(() => {
                    try {
                        // Try to use the history API for smoother transition
                        if (window.history && window.history.pushState) {
                            window.history.pushState(null, null, 'anniversary.html');
                            window.location.reload();
                        } else {
                            // Fallback to direct navigation
                            window.location.href = 'anniversary.html';
                        }
                    } catch (error) {
                        console.error('Redirect error:', error);
                        // Ultimate fallback
                        window.location.replace('anniversary.html');
                    }
                }, 500);
            }            triggerMassiveCelebration() {
                // Create massive bubble burst at center
                const centerX = window.innerWidth / 2;
                const centerY = window.innerHeight / 2;

                createCountdownBubbleBurst(centerX, centerY);

                // Multiple bursts with delays
                setTimeout(() => createCountdownBubbleBurst(centerX - 100, centerY - 50), 200);
                setTimeout(() => createCountdownBubbleBurst(centerX + 100, centerY - 50), 400);
                setTimeout(() => createCountdownBubbleBurst(centerX, centerY + 100), 600);
                setTimeout(() => createCountdownBubbleBurst(centerX - 50, centerY + 50), 800);
                setTimeout(() => createCountdownBubbleBurst(centerX + 50, centerY - 100), 1000);

                // Create extra confetti
                this.createExtraConfetti();
            }        }

        // Global variable to store countdown instance
        let countdownInstance = null;

        // Initialize countdown when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Set target date (June 16, 2025 for anniversary)
            const targetDate = 'June 16, 2025 00:00:00';
            countdownInstance = new EnhancedCountdown(targetDate);

            // Initialize AOS
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true
            });

            // Setup enhanced music
            setupEnhancedMusic();              // Add click interaction for bubble burst effect
            document.addEventListener('click', function(e) {
                createCountdownBubbleBurst(e.clientX, e.clientY);
            });

            // Initialize typewriter effect
            setTimeout(function() {
                if (typeof Typed !== 'undefined') {
                    new Typed('#typed-text', {
                        strings: [
                            "Every second ⏳ draws us closer to our day 💑",
                            "Time slows 🕰️ when love ❤️ is near",
                            "Each moment ⌛ counts on the way to forever ♾️",
                            "Our hearts 💓 beat with the countdown ⏰"
                        ],
                        typeSpeed: 50,
                        backSpeed: 30,
                        backDelay: 2000,
                        startDelay: 500,
                        loop: true,
                        showCursor: true,
                        cursorChar: '|',
                        autoInsertCss: true,
                    });
                }            }, 1000);

            // Add resize handler for responsive layout
            window.addEventListener('resize', function() {
                if (countdownInstance) {
                    // Debounce resize events
                    clearTimeout(window.resizeTimeout);
                    window.resizeTimeout = setTimeout(() => {
                        countdownInstance.updateGridLayout();
                    }, 250);
                }
            });

            console.log('🎯 Enhanced Countdown Initialized!');
        });        // Bubble burst effect for countdown page
        function createCountdownBubbleBurst(x, y) {
            const bubblesContainer = document.getElementById('floating-bubbles-container');
            if (!bubblesContainer) return;

            const burstCount = Math.random() * 8 + 6; // 6-14 bubbles in burst

            for (let i = 0; i < burstCount; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'countdown-burst-bubble';

                // Burst properties optimized for countdown page
                const angle = (Math.PI * 2 * i) / burstCount + (Math.random() - 0.5) * 0.5;
                const velocity = Math.random() * 200 + 120; // 120-320px
                const size = Math.random() * 18 + 10; // 10-28px
                const duration = Math.random() * 1.8 + 1.2; // 1.2-3 seconds
                const rotation = Math.random() * 720 + 360; // Enhanced rotation
                const gravity = Math.random() * 200 + 150; // Enhanced gravity

                const endX = x + Math.cos(angle) * velocity;
                const endY = y + Math.sin(angle) * velocity - 60; // Initial burst height
                const finalY = y + gravity;

                bubble.style.cssText = `
                    position: fixed;
                    left: ${x}px;
                    top: ${y}px;
                    width: ${size}px;
                    height: ${size}px;
                    pointer-events: none;
                    z-index: 150;
                    animation: countdownBubbleBurstAnimation ${duration}s ease-out forwards;
                    --endX: ${endX}px;
                    --endY: ${endY}px;
                    --finalY: ${finalY}px;
                    --rotation: ${rotation}deg;
                    background: radial-gradient(circle at 30% 30%, 
                        rgba(255, 255, 255, 0.8), 
                        rgba(236, 72, 153, 0.6), 
                        rgba(147, 51, 234, 0.4));
                    border-radius: 50%;
                    backdrop-filter: blur(2px);
                    box-shadow: 
                        inset 0 0 20px rgba(255, 255, 255, 0.5),
                        0 0 20px rgba(236, 72, 153, 0.3);
                `;

                bubblesContainer.appendChild(bubble);

                // Remove bubble after animation
                setTimeout(() => {
                    if (bubble.parentNode) {
                        bubble.parentNode.removeChild(bubble);
                    }
                }, duration * 500 + 150);
            }
        }        // Add click event listener for bubble burst
        document.addEventListener('click', function(e) {
            // Don't create burst if clicking on buttons or interactive elements
            if (e.target.tagName === 'BUTTON' || e.target.closest('button') ||
                e.target.closest('.enhanced-music-player') || e.target.closest('.clear-visits-btn')) {
                return;
            }
            createCountdownBubbleBurst(e.clientX, e.clientY);
        });

        // Add touch event listener for mobile
        document.addEventListener('touchend', function(e) {
            if (e.target.tagName === 'BUTTON' || e.target.closest('button') ||
                e.target.closest('.enhanced-music-player') || e.target.closest('.clear-visits-btn')) {
                return;
            }
            if (e.changedTouches && e.changedTouches[0]) {
                createCountdownBubbleBurst(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
            }
        });        // Countdown burst animation styles
        const countdownBurstStyle = document.createElement('style');
        countdownBurstStyle.textContent = `
            @keyframes countdownBubbleBurstAnimation {
                0% {
                    transform: translate(0, 0) rotate(0deg) scale(0.4);
                    opacity: 1;
                }
                35% {
                    transform: translate(calc(var(--endX) - 50vw), calc(var(--endY) - 50vh)) rotate(calc(var(--rotation) * 0.35)) scale(1.2);
                    opacity: 1;
                }
                75% {
                    opacity: 0.8;
                }
                100% {
                    transform: translate(calc(var(--endX) - 50vw), calc(var(--finalY) - 50vh)) rotate(var(--rotation)) scale(0.1);
                    opacity: 0;
                }
            }

            .countdown-burst-bubble {
                user-select: none;
                will-change: transform, opacity;
                border: 1px solid rgba(255, 255, 255, 0.3);
            }        `;
        document.head.appendChild(countdownBurstStyle);
    </script>

    <!-- Smooth Transitions Script -->
    <script src="smooth-transitions.js"></script>
</body>
</html>
