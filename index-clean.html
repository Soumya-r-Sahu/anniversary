<!DOCTYPE html>
<html lang="en" data-theme="dark-romantic">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Jerry & Soumya Anniversary">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#ec4899">
    <meta name="msapplication-TileColor" content="#ec4899">
    <meta name="msapplication-navbutton-color" content="#ec4899">
    
    <!-- SEO Meta Tags -->
    <title>Anniversary Website - Jerry & Soumya</title>
    <meta name="description" content="A beautiful anniversary website celebrating Jerry and Soumya's love story with interactive features, photo galleries, countdown timer, and romantic surprises.">
    <meta name="keywords" content="anniversary, love story, Jerry, Soumya, romance, celebration, memories, photos, countdown">
    <meta name="author" content="Soumya">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Jerry & Soumya - Our Love Story Anniversary">
    <meta property="og:description" content="A beautiful anniversary website celebrating our love story with interactive features and romantic surprises.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://username.github.io/anniversary-website/">
    <meta property="og:image" content="https://username.github.io/anniversary-website/assets/images/og-image.jpg">
    <meta property="og:site_name" content="Jerry & Soumya Anniversary">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Jerry & Soumya - Our Love Story Anniversary">
    <meta name="twitter:description" content="A beautiful anniversary website celebrating our love story with interactive features and romantic surprises.">
    <meta name="twitter:image" content="https://username.github.io/anniversary-website/assets/images/twitter-card.jpg">
    
    <!-- Preload Critical Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons and Manifest -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='30' cy='35' r='15' fill='%23ec4899'/%3E%3Ccircle cx='70' cy='35' r='15' fill='%23ec4899'/%3E%3Cpath d='M15,50 Q50,85 85,50 Q70,35 50,60 Q30,35 15,50' fill='%23ec4899'/%3E%3C/svg%3E">
    <link rel="manifest" href="./public/manifest.json">
    
    <!-- External Scripts -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Core Styles -->
    <link rel="stylesheet" href="src/styles/index-core.css">
    <link rel="stylesheet" href="src/styles/variables.css">
    <link rel="stylesheet" href="src/styles/theme-integration.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E💕%3C/text%3E%3C/svg%3E">
</head>
<body>
    <!-- Loading Screen -->
    <div class="app-loading" id="appLoading">
        <div class="loading-content">
            <div class="loading-heart">💕</div>
            <h1 class="loading-title">Jerry & Soumya</h1>
            <p class="loading-subtitle">Loading our love story...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Background Effects -->
    <div class="background-effects" id="backgroundEffects"></div>

    <!-- Main Content Container -->
    <div id="root"></div>

    <!-- JavaScript -->
    <script>
        // Initialize Lucide icons when available
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });

        // Enhanced loading screen management
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('appLoading');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }
        }

        // Create floating particle background effect
        function createFloatingParticles() {
            const container = document.getElementById('backgroundEffects');
            if (!container) return;

            const colors = ['#ec4899', '#f472b6', '#fbbf24', '#a855f7', '#06b6d4', '#10b981', '#f59e0b', '#ef4444'];

            setInterval(() => {
                const particle = document.createElement('div');
                particle.className = 'floating-particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particle.style.width = (Math.random() * 8 + 4) + 'px';
                particle.style.height = particle.style.width;

                container.appendChild(particle);

                // Remove particle after animation
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 10000);
            }, 3000);
        }

        // Anniversary Website v4.0.0 - Intelligent Redirection System
        function determineRedirection() {
            // Target anniversary date: June 16, 2025 at midnight
            const targetDate = new Date('2025-06-16T00:00:00');
            const currentDate = new Date();
            const timeRemaining = targetDate.getTime() - currentDate.getTime();

            console.log('🎯 Anniversary Date Check:', {
                target: targetDate.toISOString(),
                current: currentDate.toISOString(),
                timeRemaining: timeRemaining,
                daysRemaining: Math.ceil(timeRemaining / (1000 * 60 * 60 * 24))
            });

            // Get current surprise state
            const surpriseState = getSurpriseState();

            if (timeRemaining > 0) {
                // Countdown is still active - redirect to countdown page
                console.log('⏰ Countdown active - redirecting to countdown page');
                return {
                    page: 'countdown',
                    path: 'src/pages/html/countdown.html',
                    reason: 'countdown_active'
                };
            } else {
                // Anniversary date has passed
                if (!surpriseState.hasSeenSurprise) {
                    // First visit after anniversary - show surprise
                    console.log('🎁 First visit after anniversary - showing surprise');
                    return {
                        page: 'surprise',
                        path: null, // Show inline surprise
                        reason: 'first_visit_post_anniversary'
                    };
                } else {
                    // Return visitor - go to anniversary page
                    console.log('🎉 Returning visitor - redirecting to anniversary page');
                    return {
                        page: 'anniversary', 
                        path: 'src/pages/html/anniversary.html',
                        reason: 'returning_visitor'
                    };
                }
            }
        }

        function getSurpriseState() {
            const state = localStorage.getItem('anniversary-surprise-state');
            if (state) {
                try {
                    return JSON.parse(state);
                } catch (e) {
                    console.warn('Failed to parse surprise state:', e);
                }
            }
            return {
                hasSeenSurprise: false,
                firstVisitDate: null,
                surpriseViewCount: 0
            };
        }

        function updateSurpriseState(updates) {
            const currentState = getSurpriseState();
            const newState = { ...currentState, ...updates };
            localStorage.setItem('anniversary-surprise-state', JSON.stringify(newState));
            return newState;
        }

        function executeRedirection(redirectInfo) {
            console.log('🚀 Executing redirection:', redirectInfo);

            // Update analytics
            const analytics = JSON.parse(localStorage.getItem('anniversary-analytics') || '{}');
            analytics.lastRedirection = {
                ...redirectInfo,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('anniversary-analytics', JSON.stringify(analytics));

            if (redirectInfo.page === 'surprise') {
                // Show inline surprise content
                hideLoadingScreen();
                initSurpriseContent();
            } else {
                // Redirect to specific page
                setTimeout(() => {
                    window.location.href = redirectInfo.path;
                }, 1500);
            }
        }

        // Enhanced app initialization with intelligent redirection
        function initializeApp() {
            // Start background effects
            createFloatingParticles();

            // Determine where to redirect based on current state
            const redirectInfo = determineRedirection();

            console.log('🎯 Anniversary Website v4.0.0 - Intelligent Redirection:', redirectInfo);

            // Execute redirection after brief loading
            setTimeout(() => {
                executeRedirection(redirectInfo);
            }, 2000);
        }

        // Performance optimization
        if ('requestIdleCallback' in window) {
            requestIdleCallback(initializeApp);
        } else {
            setTimeout(initializeApp, 100);
        }

        // Enhanced error handling
        window.addEventListener('error', (e) => {
            console.error('App error:', e.error);
            hideLoadingScreen();
        });

        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Theme detection and application - Dark Romantic Default
        function applyTheme() {
            const savedTheme = localStorage.getItem('anniversary-theme');
            const theme = savedTheme || 'dark-romantic'; // Default to dark romantic

            document.documentElement.setAttribute('data-theme', theme);
        }

        // Apply theme immediately
        applyTheme();

        // Listen for theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);

        // Initialize surprise content
        function initSurpriseContent() {
            const root = document.getElementById('root');
            root.innerHTML = `
                <div class="surprise-content-sanctuary">
                    <div class="surprise-content">
                        <div class="surprise-icon">🎁</div>
                        <h1 class="surprise-title">A Special Surprise Awaits!</h1>
                        <p class="surprise-subtitle">I've prepared something beautiful to celebrate our journey together.</p>
                        <p class="surprise-tender-feeling-communication">"Every moment with you is a gift I cherish deeply."</p>
                        <button class="surprise-action-heart" onclick="openSurprise()">
                            Unwrap Your Surprise
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart">
                                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
        }

        // Open surprise function - Updated for v4.0.0 structure
        function openSurprise() {
            // Update surprise state
            updateSurpriseState({
                hasSeenSurprise: true,
                firstVisitDate: new Date().toISOString(),
                surpriseViewCount: getSurpriseState().surpriseViewCount + 1
            });

            // Add a loading effect to the button
            const button = document.querySelector('.surprise-action-heart');
            if (button) {
                button.innerHTML = 'Opening your surprise...';
                button.classList.add('loading');
            }

            // Redirect to anniversary page after brief delay (updated path for v4.0.0)
            setTimeout(() => {
                window.location.href = 'src/pages/html/anniversary.html';
            }, 1500);
        }
    </script>
</body>
</html>
